2023年3月，我所在的公司开发上线了一款三国题材策略手游。游戏侧重于在线玩家的宏大战场体验以及游戏内各种玩法对游戏结果导向的沉浸式体验。公司任命我为该项目的系统架构师。我充分利用所学知识于实战经验，带领团队对游戏的设计、开发、测试、上线部署等工作进行了深入的参与，最终顺利交付项目并受到领导的认可。本文重点讨论其中测试相关的工作尤其是单元测试、静态测试、动态测试、白盒测试、测试覆盖率等方面内容。

近年来，游戏玩家规模呈现爆发式增长，各游戏分发平台也越来越注重游戏品质与玩法体验。策略类游戏凭借其重度玩法，在游戏ip、社交等方面对玩家粘性、玩家留存、玩家付费率等游戏关键运行数据起到了直接的相较于休闲类、卡牌类等其他游戏明显的优势。因此公司决策层讨论理想一款策略类手游进行深度开发并实现可观的收益。但策略类游戏不但玩法复杂迭代频繁，而且需要满足大规模玩家同时在线的技术要求。因此游戏如何保证较高且稳定的质量是设计与开发过程中的重点与难点。我采用了单元测试的方法完成上述目标。单元测试是现代软件开发中的一项基本要素，各中软件也对单元测试进行了深度的支持。入java的maven、gradle项目管理工具，golang的原生构建工具链都有丰富且完善的单元测试选项。并且这些工具可以方便的提供代码覆盖率等重要指标的收集与展示，方便进一步的分析与迭代工作。

软件测试是使用人工或自动的手段来运行或测定某个软件系统的过程，其目的在于检验它是否满足规定的需求或弄清预期结果与实际结果之间的差别。游戏内各系统设计出来后，我要求策划团队在需求文档中标明程序交付的相关测试验收标准，程序开发完毕后首先在组内通过代码审查、代码质量工具扫描等手段完成初步质量评审工作，再按照交付文档中的验收标准通过单元测试自测无误后才可交付验收团队验收。单元测试可将测试的过程及结果归档并提交版本管理工具，方便日后bug排查与回归测试等工作。软件测试不仅是要确保软件的质量，还要给开发人员提供信息，以方便其为风险评估做相应的准备，重要的是软件测试要贯穿在整个软件开发的过程中，保证整个软件开发的过程是高质量的。

测试过程中，静态测试与动态测试涉及了测试工作的不同方面，使用不同的工具与方式对软件质量进行保证。软件测试的目的就是确保软件的质量、确认软件以正确的方式做了用户所期望的事情，所以软件测试工作主要是发现软件的错误、有效定义和实现软件成分由低层到高层的组装过程、验证软件是否满足任务书和系统定义文档所规定的技术要求、为软件质量模型的建立提供依据。

静态测试方面，有多款代码质量扫描软件可供团队选择，我所在的项目使用的是gitlab进行项目管理，golang语言进行软件开发。因此选择了golangci-lint这款代码扫描软件进行项目的静态测试工作。golangci-lint这款工具可以有效的发现软件中的冗余逻辑，死锁bug甚至不好的代码编程习惯，大大的降低了人工工作量，开发人员可以将经历投入更高维度、更深层次的工作当中。golangci-lint还可以有效的与gitlab自动构建流水线相集成，在开发人员提交代码后又系统自动执行代码的静态测试工作，可迅速及时的发现软件质量缺陷并通知相关人员进行修复。

动太测试方面，golang编译工具链提供了完善的、原生的对测试工作的支持。包括不限于单元测试、性能测试甚至是模糊测试这一行业新型的软件测试方法。策划团队在提出系统开发任务的同时，罗列出了软件质量属性的测试验收要求，开发人员根据验收要求设计单元测试的各方面要素，例如被测对象、输入、输出、测试环境、测试步骤、预期结果与实际的对比等。通过TDD也就是测试驱动开发，开发人员在编写代码之前已经对开发的整体与预期有了清晰的认知。开发阶段可通过单元测试中边界值的定义，mock对象的使用等手段有效、快速的发现平时难以觉察并复现的bug。这些测试工作通过提交版本管理工具，可在日后的软件维护与版本迭代工作中迅速的发现与历史版本不一致的内容，大大减轻了回归测试的工作成本。采用单元测试作为回归测试的手段之一，测试团队的人员编制也显著压缩，为公司节省了不菲的人力成本。

除了单元测试的开发，单元测试的结果收集与分析也是不可忽略的内容。单元测试需要将结果有效的收集并以合理的方式展示给项目管理人员。我们采用了代码覆盖率这一关键指标。代码覆盖率根据需要可细化为不同级别，例如行覆盖、分支覆盖、语句覆盖、判定覆盖等。级别越细，软件质量自然越能得到保障，但会带来越多的测试工作，需要进行合理的评估与权衡。在代码提交后，我要求团队重点关注未被测试覆盖的逻辑，通过降低代码复杂度、复用已有构建、迭代调整测试验收等手段尽可能的提高代码的测试覆盖率。并且对失败的测试用例采取零容忍的态度。一旦发现失败的用例，绝对不可以提交进版本控制工具。如果是过期无用的测试用例，需要移除并更新软件测试质量说明书；如果是更新代码引入的新bug，需要修复相关bug保证软件正确的执行；

通过单元测试的引入以及正确的单元测试方法的使用，我顺利的完成了公司指派的项目任务并高质量的交付相关产出。通过这次项目经历，我深深体会到相较于传统互联网应用的开发，单元测试在游戏软件开发中也起到了至关重要的作用。但单元测试也不是完美的，甚至部分开发人员对单元测试持有保留的态度，认为单元测试增加了额外的工作量，有使项目延期的风险。但高质量的交付开发成果是每个开发人员基本的职责。今后我将继续努力，通过更完善的理论知识与更丰富的实践经验，寻找更完善、更便捷的单元测试方法论，为公司各项目的顺利落地保驾护航。