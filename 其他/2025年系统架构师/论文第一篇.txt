2023年2月，我所在的公司开发上线了一款三国题材策略手游。游戏侧重于在线玩家宏大的战场体验以及游戏内各种玩法对游戏结果导向的沉浸式体验。公司任命我为项目的系统架构师，我充分利用所学知识与实践经验，带领团队对项目的结构设计进行了深入的分析与讨论。并将结果编制为项目需求规格说明书与测试质量说明书。项目使用基于架构的软件开发方法，经历了分析阶段、设计阶段、评审阶段、软件构建阶段、维护等。本文讨论评审阶段我带领团队进行的系统架构评估工作。涉及到了SAAM以及ATAM两种不同的方法。

软件质量属性是软件对某一方面的属性对利益相关者满足其需求的程度的可测量的指标。包括并不限于功能性、可靠性、易用性、效率、互操作性、易理解性等。针对各种质量属性，使用环境、制品、刺激源、刺激、响应、响应度量等方面构成对其描述的质量场景。架构涉及工作中的主要工作就是围绕着质量场景对架构进行评估与取舍。
SAAM方法最初关注软件的可扩展属性，后期发展到了其他质量属性方面。ATAM方法则侧重于软件的性能、可用性、安全性、可修改性。

SAAM方法有三个输入分别是问题描述、需求说明、架构描述。
近年来，游戏玩家数量呈现明显的上升趋势，各游戏分发平台也越来越注重游戏品质。策略类游戏凭借其社交属性以及重度玩法在游戏玩家留存、付费率等方面有着与其他休闲类游戏明显的优势，公司决策层讨论立项一款三国题材策略手游。游戏需要满足大规模玩家同时在线的性能需求，又要对游戏内各种玩法有灵活的扩展机制。
我根据游戏的特点与公司决策层的预期整理出项目的商业、质量、需求目标，并驱动整个项目周期的需求、设计、文档化、复审、实现与演化过程。
通过需求库，项目很快的梳理出了软件需求，通过会议头脑风暴、社区互动等方式收集了玩家、游戏策划、游戏运营不同的需求。例如玩家关注游戏的稳定性、与性能希望游戏过程中流畅不卡顿。策划要求各种玩法能顺利实现，运营则希望各种运营规则可以动态实现。设计阶段需要标识可复用的构建，分析构建间的相互作用，产生架构并进行设计评审。我邀请了不同部门的同事、公司资深开发人员以及决策层对架构的各方面进行评估。完成设计后，需要将架构进行文档化，我要求文档编写人员从使用者的角度进行编写，并分发给所有系统相关的开发人员，保证开发者受伤的文档是最新的，期间经过多次文档编写和架构复审的迭代过程，最终确认了架构的具体实现：使用面向对象的多态技术实现策划的设计落地，使用基于模板与规则引擎的技术实现运营需求，使用多线程技术满足游戏的吞吐量等性能指标让玩家又更流畅的体验。通过构建的实现与组装完成架构的落地。在完成架构的实现后根据测试质量说明书对架构进行全面的测试。

使用ATAM方法对架构的质量属性进行评审
ATAM方法主要通过质量效用树对各种质量属性进行优先级排序。在使用过程中涉及4各主要阶段，分别是：场景和需求收集、架构视图和场景实现、属性模型构建和分析、折中。在评审会议上，我需要向评审人员介绍项目的商业目标与整体架构，并介绍ATAM的使用。后续不断迭代标识各个阶段的体系结构步骤并产生、完善相应的质量效用树并分析体系结构步骤。然后通过讨论质量需求的次序、分析体系结构步骤来完成ATAM方法的测试工作。最后提交相关评审结果。
性能方面，项目要求能满足千人以上的玩家同时参与世界boss、工会战等玩法。通过使用独立构件的软件架构风格将游戏各系统解耦，使得游戏服务器的性能得到显著的提升。虽然带来少许的代码复杂度，但相比于性能上的收益是完全可以接受的。
可用性方面，项目要求服务器出现故障的时候不能影响玩家的游戏体验。通过容错设计与检错手段相结合我尽可能提高游戏各系统的鲁棒性。代码开发完成后需要不同人员进行代码审查。代码中需要有必要的错误处理逻辑与恢复块设计。服务端程序部署在k8s中里用集群技术实现服务的高可用。
安全性方面，游戏要防止黑客与恶意玩家的抓包、嗅探与数据篡改等行为。在游戏客户端与服务器交互过程中我引入了加密算法加密通信流量，并在关键业务节点检测玩家货币等关键数据是否异常。游戏中还植入了各种日志卖点方便日后审计。引入加密算法不可避免的会带来通信性能上的损失，但跟黑客攻击锁带来的损失相权衡，这方面的工作不可不做。
可修改性方面，项目通过使用热加载、脚本虚拟机与滚动更新等手段相结合使得程序的更新迭代有序进行。游戏服务器的更新主要原因有代码bug、新版本的发布、以及其他因软件运行环境产生的异常。客户端的更新主要是新版本的发布。通过脚本和热加载技术可以临时修复代码中的bug，已修复的bug在提交代码版本管理后，后期安排滚动更新计划替换已修复的问题。客户端的新版本发布主要依赖语义版本号的设计，同过主版本，附版本，以及小版本的组合可以确认游戏客户端的更新策略。

经过20个月的开发，游戏终于上线运营，受到投资方的好评与玩家的喜爱。美中不足的是，因版号原因游戏营收受到不可避免的影响，为此公司决定将游戏投放在海外市场。主要发行在东南亚等受到中国传统文化深渊影响的地区。通过这次项目经历，我深深体会到在基于架构的软件开发方法中，软件质量属性评估工作的重要性。今后我将继续努力，通过自己不断完善的理论知识与更丰富的实战经验为公司各项目的成功上限保驾护航。