2023年3月,我所在的公司开发上线了一款三国题材策略手游。游戏侧重于在线玩家宏大的战场体验以及游戏内各玩法对游戏结果导向的沉浸式体验。公司任命我为项目的架构师，我充分利用所学知识与实践经验带领团队对项目进行了面向对象的建模及应用。通过面向对象技术大大提高了项目的可性能、可用性、安全性、可修改性等方面的质量属性。此外，架构具有极强的扩展性，方便日后的维护与演化。本文讨论了我在项目期间所采用的面向对象建模方法，包括用例模型以及分析模型。

面向对象的软件开发方法是一种基于构建组装的软件开发方法。基于架构的开发方法是一种自顶向下逐步细化的方法。二者有机的结合可以充分发挥各自的优势，在开发过程中避免了面向过程开发方法尤其是瀑布模型存在的不足。可以更敏捷、更灵活的相应开发各阶段各利益相关者的各方面诉求。

近年来，游戏玩家呈现爆发式增长，各游戏分发平台也越来越注重游戏质量与玩法体验。策略类游戏凭借其重度玩法以及强社交的属性，在玩家粘性、玩家留存、玩家付费等关键运营指标上有着相较于休闲类等其他类别游戏天然的优势。因此公司决策层讨论理想一款策略类手游进行深度开发并预期实现可观的收益。但策略类游戏又有着及其复杂的机制与较高的性能要求，并且在游戏后期需要根据运营策略快速响应市场需求。因此瀑布模型这种经典的面向过程的软件开发方法回带来开发周期长，反馈不及时，测试阶段靠后不能有效即使发现系统缺陷甚至前期设计不合理导致系统返工重做的重大风险。基于面向对象的软件开发方法，在体系结构的场景与需求收集、体系结构视图与场景实现、场景与质量属性的开发，质量属性的评价与折中各阶段都能发挥积极作用。尤其是需求与分析阶段，面向对象有用例模型与分析模型两种方法极大的提高了软件体系结构的质量。

用例模型使用用例来获取用户的需求，通过识别参与者、合并需求获得用例。细化用例描述。调整用例模型来获取务求并进一步对架构进行设计。

游戏项目的用户包括不限于：玩家、定时器、运营工作人员、报表数据采集系统等。获得的用例包括不限于。参与各种玩法。定时器负责触发游戏内各种资源的产生。运营工作人员根据规则配置上线新的运营活动。报表数据采集系统采集线上数据生成报表。每个用例经过细化之后补充描述信息。名称。前置条件后置条件。扩展点。事件流。最后可对用例进行包含关系泛化关系的的调整以精简架构设计。

例如，玩家参与boss战的用例模型可设计为：

参与者：有定时器；用例：定时触发活动开启、boss刷新、活动广播、活动结束、奖励结算。各个用例包含加载数据配置文件的子用例，活动广播用例又分别是活动开启、奖励结算用例的扩展子用例，再满足特定条件后触发对特定玩家的广播事件。

参与者：玩家；用例：报名活动，进入副本，参与战斗，领取奖励。其中报名战斗与领取奖励又分别包含验证参与条件的子用例。领取奖励则是参与战斗的扩展用例。而玩家角色经过整理后又可泛化出工会会长、普通玩家、获奖玩家等不同角色。

用例模型是常用的面向对象获取需求的手段，除了用例模型，还可以使用分析模型进行系统的需求以及体系结构的设计工作进行建模。分析模型需要识别概念类、分析类之间的关系、为类添加职责，最后为类建立交互图。

面向对象的设计中，又3中不同的类。分别是实体类、边界类、控制类。实体类相当于面向过程设计中E-R图中的实体，主要负责数据的持久化。边界类主要负责用户界面的交互，是用户与系统间的沟通接口。控制类则负责软件系统中的业务流程、将实体类与边界类联系在一起完成响应的功能。

在实际开发中，游戏客户端与服务器交互使用了protobuf生成数据传输的类，这些类属于边界类，其反应了玩家在游戏中与系统的交互。当玩家在商城够购买道具时客户端生成对应的protobuf类并初始化所需的参数发往服务器进行购买业务的处理。服务器通常使用mvc架构，controller层的控制类在接受客户端的操作请求后通过数据校验，规则解析，路由转发等逻辑后触发实体类的相关状态变更。实体类是业务的核心状态的表示，包括不限于玩家当前的货币数量，背包中的道具以及限购次数等。实体的一切状态转换最终都需要持久化到数据库中。

在面向对象的软件设计中，类之间有不同种类的关系，分别是依赖关系、关联关系、聚合关系、组合关系、泛化关系、实现关系。不同的关系决定了不同的类给自应有的职责。

例如，商城类依赖玩家的背包类以及系统的货币实体类，而背包类又与玩家的战斗系统中的类存在关联关系，在玩家购买战斗道具后升级玩家战力。商城类中则组合了商品类，又聚合了限购相关控制类。商城又可泛化出每日商城、活动商城、工会商城等不同类。实现关系则在面向对象中又着更重要的作用与广泛的使用。例如迪米特法则、接口隔离原则、依赖倒置原则等都是在实现关系上发展出来的。游戏的开发也需要先设计出各种接口，再针对接口做具体实现类的开发，例如先设计出装备接口，再具体开发出武器、护甲、饰品等实现类。

通过面向对象的分析与设计，尤其是用例模型与分析模型的使用，我带领团队高质量的完成了整个游戏的体系结构设计，使得体系结构易于理解、易于扩展，游戏上线后能稳定运行。经过这次项目经历，我深深体会到相较于传统传统互联网应用，面向对象的理论与工具在游戏开发中也发挥着举足轻重的作用。今后我将继续努力，使用更完善的理论知识与更丰富的实践经验为公司各项目的顺利落地保驾护航。