&emsp;&emsp;2022年8月，我所在的公司开发上线了一款三国题材的策略类手游。游戏侧重于在线玩家的宏大战场体验以及游戏内各玩法对游戏结果导向的沉浸式体验。公司领导任命我为该项目的系统分析师，我充分运用所学的理论知识与实践经验，带领团队在游戏开发中使用多种面向对象设计模式以提升项目的健壮性、可扩展性、可维护性。本文根据我在工作期间的分析与设计工作，着重讨论装饰器模式、工厂模式、命令模式、责任链模式的运用。项目历经20个月的开发、耗资2300万，上线后20个月实现成本回收。受到投资方、运营方的表扬，并获得玩家的喜爱。

&emsp;&emsp;通过使用面向对象的设计模式，我为公司节省了开发周期8个月。并有效减少了线上bug率以及新需求的响应、开发周期。近年来，游戏玩家呈现爆发式增长，各游戏分发平台也越来越注重游戏的玩法与玩家的体验。策略类游戏凭借其重度的玩法，在游戏ip、社交等方面对玩家粘性、玩家留存、玩家付费率等关键游戏指标起到了相较于休闲类、卡牌类等其他游戏明显的优势。因此公司决策层讨论立项一款策略类手游，进行深度开发并实现可观的收益。因玩家集中在东南亚范围，受到中国传统文化的影响深远，因此公司决定使用三国这一大家耳熟能详的历史题材作为游戏背景。在游戏中，玩家扮演诸侯英雄体验从白手起家到一统三国的梦幻经历。游戏开发成本800万，美术外包费用300万，后期运营买量成本1200万。技术上客户端使用unity开发工具，服务端使用java这一面向对象语言。美术资源为公司自研发加外包的形式。玩法上沿用了市面上大多数策略类游戏的基本玩法来降低玩家上手难度，并特别设计了“雄才技能”这一特殊玩法来提升玩家的游戏体验。在开发中，面向对象设计模式为游戏的高质量以及玩家的良好体验起到了关键作用，是公司能顺利实现成本回收并盈利的有效保障。

&emsp;&emsp;一、装饰器模式

&emsp;&emsp;装饰器模式数据结构型模式，通过定义接口，可以为实体对象动态增加新功能而不用修改已存在的代码。在游戏中玩家控制的单位、npc以及各类场景均有不同的功能以及玩法。如果不使用设计模式会导致代码拥挤在一个方法逻辑中，随着开发进度的推进，该方法会膨胀到无法维护、增加了引入bug的几率、并且多人同时修改不同功能导致代码提交冲突降低开发效率。引入装饰器模式后，游戏内为玩家、npc以及各类场景提供一套接口，不同的功能和玩法通过不同的实现类来引入。逻辑分散后有效消除了不可维护的大方法和代码的提交冲突。新增的需求提供新的实现类避免了修改已经实现的功能减少了引入bug的几率。装饰器模式时开发人员幸福指数最高的模式之一。

&emsp;&emsp;二、工厂模式

&emsp;&emsp;工厂模式提供了代码中对对象的创建逻辑，有工厂方法模式，抽象工厂模式等。游戏中有大量的npc以及场景会在不同的时机、不同的规则下创建。传统的基于new关键字的对象创建方式缺乏灵活性。对象创建往往依赖特定的上下文信息，导致了代码中存在大量重复逻辑来获取所需的上下文。同过引入工厂类或者工厂方法，封装了获取上下文的逻辑，降低了代码的耦合度。在游戏内不同时机可根据不同的规则灵活创建对象。另外，开发过程中，开发人员经常需要对代码进行重构工作，传统基于new关键字的对象创建方式不利于重构，因为暴露了创建对象所需的信息到外部，导致调整构造参数时会引发编译错误，同样因为封装了上下文，工厂模式对重构非常友好。工厂模式有效的降低了开发工作量。

&emsp;&emsp;三、命令模式

&emsp;&emsp;命令模式属于行为型模式，同过将代码中的逻辑封装成不同的命令并提供统一的接口暴露给调用者，提高了代码的内聚性，减少了代码的耦合性。并且命令模式可以有效的应用在并发环境下，提高系统的性能，为服务器端进程的动态扩容和可伸缩提供了必要的保障。游戏中又可以将玩家的操作封装为不同的命令，进一步可以将这些命令与消息队列结合使用，通过消息队列的批量处理极大的提高了客户端的性能，使玩家达到了极致的游戏体验。通过分析消息队列，可以很容易的了解到玩家行为习惯，为公司提供更精确的核心玩家的用户画像。命令模式是价值最高的设计模式。

&emsp;&emsp;四、责任链模式

&emsp;&emsp;责任链模式属于行为型模式，将逻辑封装为一个操作链上的不同节点实现对逻辑的动态控制。作为一个商业项目，代码中需要大量的非游戏性业务逻辑。比如防外挂、防玩家刷金、性能监控、sdk埋点等。这些逻辑并不适合写在同一处代码中，否则容易使得代码从标记耦合提高至内容耦合。例如，玩家在游戏内发出某个操作请求时，可以将这些逻辑封装成为责任链上的不同节点，经过防外挂、防刷金，记录玩家埋点日志，监控吞吐量指标等链上每一个节点逻辑的处理后，玩家的操作最终被响应。责任链模式体现出了开发人员的专业性。

&emsp;&emsp;项目的成功，得益于设计模式的引入。提前规避了关键风险、提高了开发效率和项目质量，为项目的成功发挥了重要作用。经过将近两年的开发，游戏终于在日本、韩国、欧美以及台湾地区上线。经受住了大规模玩家同时在线的考验，在玩家游戏体验，公司运营决策、开发人员工作体验等方面交出了一份令大家都满意的答卷。美中不足的是，游戏上线运营后，早期代发的许多代码最终被抛弃，但这也从侧面印证了面向对象设计模式能降低代码耦合性的优点。经过这次项目经历，我深深体会到于传统互联网应用开发相比，面向对象设计模式在游戏开发中也起到了至关重要的作用。今后我将继续努力，理论与实践结合，为项目的成功落地保驾护航。
